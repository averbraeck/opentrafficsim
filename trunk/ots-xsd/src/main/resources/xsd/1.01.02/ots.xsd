<?xml version="1.0" encoding="UTF-8"?>
<xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema" targetNamespace="http://www.opentrafficsim.org/ots"
  xmlns:ots="http://www.opentrafficsim.org/ots" xmlns="http://www.opentrafficsim.org/ots"
  xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  elementFormDefault="qualified">

  <!-- http://www.w3.org/2009/01/xml.xsd -->
  <xsd:import namespace="http://www.w3.org/XML/1998/namespace" schemaLocation="../ref/xml.xsd" />
  <!-- http://www.w3.org/2001/xinclude.xsd -->
  <xsd:import namespace="http://www.w3.org/2001/XInclude" schemaLocation="../ref/xinclude.xsd" />

  <xsd:include schemaLocation="ots-definitions.xsd" />
  <xsd:include schemaLocation="ots-network.xsd" />
  <xsd:include schemaLocation="ots-demand.xsd" />
  <xsd:include schemaLocation="ots-control.xsd" />
  <xsd:include schemaLocation="ots-model.xsd" />
  <xsd:include schemaLocation="ots-scenario.xsd" />
  <xsd:include schemaLocation="ots-run.xsd" />
  <xsd:include schemaLocation="ots-animation.xsd" />

  <xsd:element name="OTS">
    <xsd:complexType>
      <xsd:sequence>
        <xsd:element ref="DEFINITIONS" minOccurs="1" maxOccurs="1" />
        <xsd:element ref="NETWORK" minOccurs="1" maxOccurs="1" />
        <xsd:element ref="DEMAND" minOccurs="0" maxOccurs="unbounded" />
        <xsd:element ref="CONTROL" minOccurs="0" maxOccurs="unbounded" />
        <xsd:element ref="MODEL" minOccurs="0" maxOccurs="1" />
        <xsd:element ref="SCENARIO" minOccurs="0" maxOccurs="1" />
        <xsd:element ref="RUN" minOccurs="1" maxOccurs="1" />
        <xsd:element ref="ANIMATION" minOccurs="0" maxOccurs="1" />
      </xsd:sequence>
      <xsd:attribute ref="xml:base" />
      <xsd:attribute ref="xml:space" use="optional" default="preserve" />
    </xsd:complexType>

    <!-- define the DEFINITIONS.GTUTYPE.NAME key -->

    <xsd:key name="gtuTypeKey">
      <xsd:selector xpath="ots:DEFINITIONS/ots:GTUTYPE" />
      <xsd:field xpath="@ID" />
    </xsd:key>

    <!-- define the DEFINITIONS.GTUMIX.NAME key -->

    <xsd:key name="gtuMixKey">
      <xsd:selector xpath="ots:DEFINITIONS/ots:GTUMIX" />
      <xsd:field xpath="@ID" />
    </xsd:key>

    <!-- define the DEFINITIONS.GTU.NAME key -->

    <xsd:key name="gtuKey">
      <xsd:selector xpath="ots:DEFINITIONS/ots:GTU" />
      <xsd:field xpath="@ID" />
    </xsd:key>

    <!-- define the DEFINITIONS.ROADLAYOUT.NAME key -->

    <xsd:key name="roadLayoutKey">
      <xsd:selector xpath="ots:DEFINITIONS/ots:ROADLAYOUT" />
      <xsd:field xpath="@ID" />
    </xsd:key>

    <!-- define the DEFINITIONS.LINKTYPES.LINKTYPE.NAME key -->

    <xsd:key name="linkTypeKey">
      <xsd:selector xpath="ots:DEFINITIONS/ots:LINKTYPES/ots:LINKTYPE" />
      <xsd:field xpath="@ID" />
    </xsd:key>

    <!-- define the DEFINITIONS.LANETYPE.NAME key -->

    <xsd:key name="laneTypeKey">
      <xsd:selector xpath="ots:DEFINITIONS/ots:LANETYPE" />
      <xsd:field xpath="@ID" />
    </xsd:key>

    <!-- define the NODE.NAME key -->

    <xsd:key name="nodeKey">
      <xsd:selector xpath="ots:NETWORK/ots:NODE" />
      <xsd:field xpath="@ID" />
    </xsd:key>

    <!-- define the LINK.NAME key -->

    <xsd:key name="linkKey">
      <xsd:selector xpath="ots:NETWORK/ots:LINK" />
      <xsd:field xpath="@ID" />
    </xsd:key>

    <!-- define the ROUTE.NAME key -->

    <xsd:key name="routeKey">
      <xsd:selector xpath="ots:NETWORK/ots:ROUTE" />
      <xsd:field xpath="@ID" />
    </xsd:key>

    <!-- define the ROUTEMIX.NAME key -->

    <xsd:key name="routeMixKey">
      <xsd:selector xpath="ots:NETWORK/ots:ROUTEMIX" />
      <xsd:field xpath="@ID" />
    </xsd:key>

    <!-- define the SHORTESTROUTE.NAME key -->

    <xsd:key name="shortestRouteKey">
      <xsd:selector xpath="ots:NETWORK/ots:SHORTESTROUTE" />
      <xsd:field xpath="@ID" />
    </xsd:key>

    <!-- define the SHORTESTROUTEMIX.NAME key -->

    <xsd:key name="shortestRouteMixKey">
      <xsd:selector xpath="ots:NETWORK/ots:SHORTESTROUTEMIX" />
      <xsd:field xpath="@ID" />
    </xsd:key>

    <!-- define the SIGNALGROUP.ID key -->

    <xsd:key name="signalGroupKey">
      <xsd:selector xpath="ots:NETWORK/ots:SIGNALGROUP" />
      <xsd:field xpath="@ID" />
    </xsd:key>

    <!-- DEFINITIONS.GTU.GTUTYPE defined by DEFINITIONS.GTUTYPE.NAME -->

    <xsd:keyref name="gtuTypeRef" refer="ots:gtuTypeKey">
      <xsd:selector xpath="ots:DEFINITIONS/ots:GTU" />
      <xsd:field xpath="@GTUTYPE" />
    </xsd:keyref>

    <!-- DEFINITIONS.GTUMIX.GTU.NAME defined by DEFINITIONS.GTU.NAME -->

    <xsd:keyref name="gtuMixGtuRef" refer="ots:gtuKey">
      <xsd:selector xpath="ots:DEFINITIONS/ots:GTUMIX/ots:GTU" />
      <xsd:field xpath="@ID" />
    </xsd:keyref>

    <!-- DEFINITIONS.ROADTYPE.SPEEDLIMITS.GTUTYPE defined by DEFINITIONS.GTUTYPE.NAME -->

    <xsd:keyref name="roadTypeGtuTypeRef" refer="ots:gtuTypeKey">
      <xsd:selector xpath="ots:DEFINITIONS/ots:ROADTYPE/ots:SPEEDLIMITS" />
      <xsd:field xpath="@GTUTYPE" />
    </xsd:keyref>

    <!-- DEFINITIONS.LANETYPE.GTUTYPE.NAME defined by DEFINITIONS.GTUTYPE.NAME -->

    <xsd:keyref name="laneTypeGtuTypeRef" refer="ots:gtuTypeKey">
      <xsd:selector xpath="ots:DEFINITIONS/ots:LANETYPE/ots:GTUTYPE" />
      <xsd:field xpath="@ID" />
    </xsd:keyref>

    <!-- DEFINITIONS.ROADLAYOUT.ROADTYPE defined by DEFINITIONS.LINKTYPES.LINKTYPE.NAME -->

    <xsd:keyref name="roadLayoutRoadTypeRef" refer="ots:linkTypeKey">
      <xsd:selector xpath="ots:DEFINITIONS/ots:ROADLAYOUT" />
      <xsd:field xpath="@ROADTYPE" />
    </xsd:keyref>

    <!-- DEFINITIONS.ROADLAYOUT.LANE.LANETYPE defined by DEFINITIONS.LANETYPE.NAME -->

    <xsd:keyref name="RoadLayoutLanelaneTypeRef" refer="ots:laneTypeKey">
      <xsd:selector xpath="ots:DEFINITIONS/ots:ROADLAYOUT/ots:LANE" />
      <xsd:field xpath="@LANETYPE" />
    </xsd:keyref>

    <!-- NETWORK.CONNECTORTYPE.NODESTART defined by NODE.NAME -->

    <xsd:keyref name="linkNodeStartNodeRef" refer="ots:nodeKey">
      <xsd:selector xpath="ots:NETWORK/ots:CONNECTORTYPE" />
      <xsd:field xpath="@NODESTART" />
    </xsd:keyref>

    <!-- NETWORK.CONNECTORTYPE.NODEEND defined by NODE.NAME -->

    <xsd:keyref name="linkNodeEndNodeRef" refer="ots:nodeKey">
      <xsd:selector xpath="ots:NETWORK/ots:CONNECTORTYPE" />
      <xsd:field xpath="@NODEEND" />
    </xsd:keyref>
    
    <!-- NETWORK.LINK.GENERATOR.GTU defined by DEFINITIONS.GTU.NAME -->

    <xsd:keyref name="linkGeneratorGtuRef" refer="ots:gtuKey">
      <xsd:selector xpath="ots:NETWORK/ots:LINK/ots:GENERATOR" />
      <xsd:field xpath="@GTU" />
    </xsd:keyref>

    <!-- NETWORK.LINK.GENERATOR.GTUMIX defined by DEFINITIONS.GTUMIX.NAME -->

    <xsd:keyref name="linkGeneratorGtuMixRef" refer="ots:gtuMixKey">
      <xsd:selector xpath="ots:NETWORK/ots:LINK/ots:GENERATOR" />
      <xsd:field xpath="@GTUMIX" />
    </xsd:keyref>

    <!-- NETWORK.LINK.GENERATOR.ROUTE defined by ROUTE.NAME -->

    <xsd:keyref name="linkGeneratorRouteRef" refer="ots:routeKey">
      <xsd:selector xpath="ots:NETWORK/ots:LINK/ots:GENERATOR" />
      <xsd:field xpath="@ROUTE" />
    </xsd:keyref>

    <!-- NETWORK.LINK.LISTGENERATOR.GTU defined by DEFINITIONS.GTU.NAME -->

    <xsd:keyref name="linkListGeneratorGtuRef" refer="ots:gtuKey">
      <xsd:selector xpath="ots:NETWORK/ots:LINK/ots:LISTGENERATOR" />
      <xsd:field xpath="@GTU" />
    </xsd:keyref>

    <!-- NETWORK.LINK.LISTGENERATOR.GTUMIX defined by DEFINITIONS.GTUMIX.NAME -->

    <xsd:keyref name="linkListGeneratorGtuMixRef" refer="ots:gtuMixKey">
      <xsd:selector xpath="ots:NETWORK/ots:LINK/ots:LISTGENERATOR" />
      <xsd:field xpath="@GTUMIX" />
    </xsd:keyref>

    <!-- NETWORK.LINK.FILL.GTU defined by DEFINITIONS.GTU.NAME -->

    <xsd:keyref name="linkFillGtuRef" refer="ots:gtuKey">
      <xsd:selector xpath="ots:NETWORK/ots:LINK/ots:FILL" />
      <xsd:field xpath="@GTU" />
    </xsd:keyref>

    <!-- NETWORK.LINK.LISTGENERATOR.ROUTE defined by ROUTE.NAME -->

    <xsd:keyref name="linkListGeneratorRouteRef" refer="ots:routeKey">
      <xsd:selector xpath="ots:NETWORK/ots:LINK/ots:LISTGENERATOR" />
      <xsd:field xpath="@ROUTE" />
    </xsd:keyref>

    <!-- NETWORK.LINK.FILL.GTUMIX defined by DEFINITIONS.GTUMIX.NAME -->

    <xsd:keyref name="linkFillGtuMixRef" refer="ots:gtuMixKey">
      <xsd:selector xpath="ots:NETWORK/ots:LINK/ots:FILL" />
      <xsd:field xpath="@GTUMIX" />
    </xsd:keyref>

    <!-- NETWORK.LINK.FILL.ROUTE defined by ROUTE.NAME -->

    <xsd:keyref name="linkFillRouteRef" refer="ots:routeKey">
      <xsd:selector xpath="ots:NETWORK/ots:LINK/ots:FILL" />
      <xsd:field xpath="@ROUTE" />
    </xsd:keyref>

    <!-- NETWORK.LINK.ROADTYPE defined by DEFINITIONS.LINKTYPE.NAME -->

    <xsd:keyref name="linkRoadTypeRef" refer="ots:linkTypeKey">
      <xsd:selector xpath="ots:NETWORK/ots:LINK" />
      <xsd:field xpath="@ROADTYPE" />
    </xsd:keyref>

    <!-- NETWORK.SHORTESTROUTE.FROM defined by NODE.NAME -->

    <xsd:keyref name="shortestRouteFromNodeRef" refer="ots:nodeKey">
      <xsd:selector xpath="ots:NETWORK/ots:SHORTESTROUTE" />
      <xsd:field xpath="@FROM" />
    </xsd:keyref>

    <!-- NETWORK.SHORTESTROUTE.TO defined by NODE.NAME -->

    <xsd:keyref name="shortestRouteToNodeRef" refer="ots:nodeKey">
      <xsd:selector xpath="ots:NETWORK/ots:SHORTESTROUTE" />
      <xsd:field xpath="@TO" />
    </xsd:keyref>

    <!-- NETWORK.ROUTEMIX.ROUTE defined by ROUTE.NAME -->

    <xsd:keyref name="RouteMixRouteRef" refer="ots:routeKey">
      <xsd:selector xpath="ots:NETWORK/ots:ROUTEMIX" />
      <xsd:field xpath="@ROUTE" />
    </xsd:keyref>

    <!-- NETWORK.SHORTESTROUTEMIX.SHORTESTROUTE defined by SHORTESTROUTE.NAME -->

    <xsd:keyref name="shortestRouteMixShortestRouteRef" refer="ots:shortestRouteKey">
      <xsd:selector xpath="ots:NETWORK/ots:SHORTESTROUTEMIX" />
      <xsd:field xpath="@SHORTESTROUTE" />
    </xsd:keyref>

    <!-- CONTROL.FIXEDTIME.SIGNALGROUP.ID defined by SIGNALGROUP.ID -->

    <xsd:keyref name="signalGroupFixedTimeRef" refer="ots:signalGroupKey">
      <xsd:selector xpath="ots:CONTROL/ots:FIXEDTIME/ots:SIGNALGROUP" />
      <xsd:field xpath="@ID" />
    </xsd:keyref>

    <!-- NETWORK.SIGNALGROUP.TRAFFICLIGHT.LINK defined by LINK.ID -->

    <xsd:keyref name="signalGroupTrafficLightLink" refer="ots:linkKey">
      <xsd:selector xpath="ots:NETWORK/ots:SIGNALGROUP/ots:TRAFFICLIGHT" />
      <xsd:field xpath="@LINK" />
    </xsd:keyref>
    
    <!-- MODEL.MODELPARAMETER.GTUTYPE defined by DEFINITIONS.GTUTYPE -->
    <xsd:keyref name="modelParameterGtuTypeLink" refer="ots:gtuKey">
      <xsd:selector xpath="ots:MODEL/ots:MODELPARAMETER" />
      <xsd:field xpath="@GTUTYPE" />
    </xsd:keyref>

  </xsd:element>

</xsd:schema>