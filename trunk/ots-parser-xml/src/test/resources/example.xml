<?xml version="1.0" encoding="UTF-8" ?>
<OTS xmlns="http://www.opentrafficsim.org/ots" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.opentrafficsim.org/ots https://opentrafficsim.org/docs/xsd/1.02.01/ots.xsd"
  xmlns:xi="http://www.w3.org/2001/XInclude">

  <DEFINITIONS>

    <xi:include href="xsd/1.02.01/defaults/default_gtutypes.xml">
      <xi:fallback>
        <xi:include href="https://opentrafficsim.org/docs/xsd/1.02.01/defaults/default_gtutypes.xml" />
      </xi:fallback>
    </xi:include>

    <GTUTYPES>
      <GTUTYPE ID="AUTOMATED_CAR" PARENT="VEHICLE" />
    </GTUTYPES>

    <xi:include href="xsd/1.02.01/defaults/default_linktypes.xml">
      <xi:fallback>
        <xi:include href="https://opentrafficsim.org/docs/xsd/1.02.01/defaults/default_linktypes.xml" />
      </xi:fallback>
    </xi:include>

    <LINKTYPES>
      <LINKTYPE ID="HIGHWAY2x2" DEFAULT="false" PARENT="FREEWAY">
        <COMPATIBILITY GTUTYPE="VEHICLE" DIRECTION="FORWARD" />
        <COMPATIBILITY GTUTYPE="AUTOMATED_CAR" DIRECTION="FORWARD" />
        <COMPATIBILITY GTUTYPE="PEDESTRIAN" DIRECTION="NONE" />
        <COMPATIBILITY GTUTYPE="BICYCLE" DIRECTION="NONE" />
      </LINKTYPE>
    </LINKTYPES>

    <xi:include href="xsd/1.02.01/defaults/default_lanetypes.xml">
      <xi:fallback>
        <xi:include href="https://opentrafficsim.org/docs/xsd/1.02.01/defaults/default_lanetypes.xml" />
      </xi:fallback>
    </xi:include>

    <LANETYPES>
      <LANETYPE ID="HIGHWAYLANE2x2" DEFAULT="false" PARENT="FREEWAY">
        <COMPATIBILITY GTUTYPE="VEHICLE" DIRECTION="FORWARD" />
        <COMPATIBILITY GTUTYPE="AUTOMATED_CAR" DIRECTION="FORWARD" />
        <COMPATIBILITY GTUTYPE="PEDESTRIAN" DIRECTION="NONE" />
        <COMPATIBILITY GTUTYPE="BICYCLE" DIRECTION="NONE" />
      </LANETYPE>
    </LANETYPES>

    <xi:include href="xsd/1.02.01/defaults/default_gtutemplates.xml">
      <xi:fallback>
        <xi:include href="https://opentrafficsim.org/docs/xsd/1.02.01/defaults/default_gtutemplates.xml" />
      </xi:fallback>
    </xi:include>

    <GTUTEMPLATES>
      <GTUTEMPLATE ID="AUTOCAR" GTUTYPE="AUTOMATED_CAR">
        <LENGTHDIST LENGTHUNIT="m">
          <UNIFORM MIN="4" MAX="5" />
        </LENGTHDIST>
        <WIDTHDIST LENGTHUNIT="m">
          <TRIANGULAR MIN="1.5" MODE="1.6" MAX="1.7" />
        </WIDTHDIST>
        <MAXSPEEDDIST SPEEDUNIT="km/h">
          <UNIFORM MIN="90" MAX="110" />
        </MAXSPEEDDIST>
      </GTUTEMPLATE>
    </GTUTEMPLATES>

    <!--
    Design line goes from left to right.
    
    _______________ +6m
    shoulder center +5m                           A
    _______________ +4m                          / \
    lane center L1  +3m  <== driving direction    |
    - - - - - - - - +2m                           |
    lane center L2  +1m  <== driving direction    |
    ==============>  0m                           | specification
    lane center R2  -1m  ==> driving direction    | sequence
    - - - - - - - - -2m                           |
    lane center R1  -3m  ==> driving direction    |
    _______________ -4m                           |
    shoulder center -5m                           |
    _______________ -6m
    
    Specification goes from bottom (negative offset) to top (positive offset). 
    -->

    <ROADLAYOUTS>
      <ROADLAYOUT LINKTYPE="HIGHWAY2x2" ID="HW22">
        <STRIPE TYPE="SOLID" />
        <SHOULDER>
          <WIDTH>2m</WIDTH>
        </SHOULDER>
        <STRIPE TYPE="SOLID" />
        <LANE ID="R1" DESIGNDIRECTION="false" LANETYPE="HIGHWAYLANE2x2">
          <WIDTH>2m</WIDTH>
        </LANE>
        <STRIPE TYPE="DASHED" />
        <LANE ID="R2" DESIGNDIRECTION="false" LANETYPE="HIGHWAYLANE2x2">
          <WIDTH>2m</WIDTH>
        </LANE>
        <STRIPE TYPE="DOUBLE">
          <CENTEROFFSET>0m</CENTEROFFSET>
        </STRIPE>
        <LANE ID="L2" DESIGNDIRECTION="true" LANETYPE="HIGHWAYLANE2x2">
          <WIDTH>2m</WIDTH>
        </LANE>
        <STRIPE TYPE="DASHED" />
        <LANE ID="L1" DESIGNDIRECTION="true" LANETYPE="HIGHWAYLANE2x2">
          <WIDTH>2m</WIDTH>
        </LANE>
        <STRIPE TYPE="SOLID" />
        <SHOULDER>
          <WIDTH>2m</WIDTH>
        </SHOULDER>
        <STRIPE TYPE="SOLID" />
      </ROADLAYOUT>
    </ROADLAYOUTS>

  </DEFINITIONS>

  <NETWORK>

    <NODE COORDINATE="(0,0)" ID="N1" DIRECTION="10.0 deg"/>
    <NODE COORDINATE="(100,0)" ID="N2" />
    <NODE COORDINATE="(300,100)" ID="N3" />
    <NODE COORDINATE="(400,100)" ID="N4" />
    <NODE COORDINATE="(450,100)" ID="N5" />

    <LINK NODESTART="N1" NODEEND="N2" ID="L12"  OFFSETSTART="0.0 m" OFFSETEND="0.0 m">
      <BEZIER NUMSEGMENTS="128"/>
      <DEFINEDLAYOUT>HW22</DEFINEDLAYOUT>
    </LINK>

    <LINK NODESTART="N2" NODEEND="N3" ID="L23">
      <BEZIER NUMSEGMENTS="128" />
      <DEFINEDLAYOUT>HW22</DEFINEDLAYOUT>
    </LINK>

    <LINK NODESTART="N3" NODEEND="N4" ID="L34">
      <POLYLINE>
        <COORDINATE>(325,105)</COORDINATE>
        <COORDINATE>(350,100)</COORDINATE>
        <COORDINATE>(375,95)</COORDINATE>
      </POLYLINE>
      <DEFINEDLAYOUT>HW22</DEFINEDLAYOUT>
    </LINK>

    <LINK NODESTART="N4" NODEEND="N5" ID="L45">
      <STRAIGHT />
      <DEFINEDLAYOUT>HW22</DEFINEDLAYOUT>
    </LINK>

    <ROUTE ID="A">
      <NODE ID="N1" />
      <NODE ID="N2" />
      <NODE ID="N3" />
      <NODE ID="N4" />
    </ROUTE>

  </NETWORK>

  <NETWORKDEMAND>
    <GENERATOR LINK="L12" DIRECTION="DIR_PLUS" LANE="R1" POSITION="10m">
      <GTUTEMPLATE>CAR</GTUTEMPLATE>
      <ROUTE>A</ROUTE>
      <IAT DURATIONUNIT="s">
        <EXPONENTIAL LAMBDA="10" />
      </IAT>
      <ROOMCHECKER>CF</ROOMCHECKER>
    </GENERATOR>
    <GENERATOR LINK="L12" DIRECTION="DIR_PLUS" LANE="R2" POSITION="10m">
      <GTUTEMPLATE>CAR</GTUTEMPLATE>
      <ROUTE>A</ROUTE>
      <IAT DURATIONUNIT="s">
        <EXPONENTIAL LAMBDA="10" />
      </IAT>
      <ROOMCHECKER>CF</ROOMCHECKER>
    </GENERATOR>
  </NETWORKDEMAND>

  <SCENARIO ID="scenario1">
    <INPUTPARAMETERS>
      <STRING ID="model.name">Test model</STRING>
      <ACCELERATION ID="model.car.a">1.8 m/s^2</ACCELERATION>
      <ACCELERATION ID="model.car.b">3 m/s^2</ACCELERATION>
      <ACCELERATIONDIST ID="model.car.c" ACCELERATIONUNIT="m/s^2"><UNIFORM MIN="1.0" MAX="2.0"/></ACCELERATIONDIST>
    </INPUTPARAMETERS>
  </SCENARIO>
  
  <RUN>
    <RUNLENGTH>1h</RUNLENGTH>
    <NUMBERREPLICATIONS>2</NUMBERREPLICATIONS>
    <RANDOMSTREAMS>
      <RANDOMSTREAM ID="default">
        <REPLICATION ID="1" SEED="1" />
        <REPLICATION ID="2" SEED="2" />
      </RANDOMSTREAM>
      <RANDOMSTREAM ID="generator">
        <REPLICATION ID="1" SEED="11" />
        <REPLICATION ID="2" SEED="12" />
      </RANDOMSTREAM>
    </RANDOMSTREAMS>
  </RUN>

</OTS>
