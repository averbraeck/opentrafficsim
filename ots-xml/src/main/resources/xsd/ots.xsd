<?xml version="1.0" encoding="UTF-8"?>
<xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema" targetNamespace="http://www.opentrafficsim.org/ots"
  xmlns:ots="http://www.opentrafficsim.org/ots" xmlns:xi="http://www.w3.org/2001/XInclude" elementFormDefault="qualified">

  <!-- http://www.w3.org/2009/01/xml.xsd -->
  <xsd:import namespace="http://www.w3.org/XML/1998/namespace" schemaLocation="ref/xml.xsd" />

  <xsd:include schemaLocation="ots-definitions.xsd" />
  <xsd:include schemaLocation="ots-network.xsd" />
  <xsd:include schemaLocation="ots-demand.xsd" />
  <xsd:include schemaLocation="ots-control.xsd" />
  <xsd:include schemaLocation="ots-model.xsd" />
  <xsd:include schemaLocation="ots-scenario.xsd" />
  <xsd:include schemaLocation="ots-run.xsd" />
  <xsd:include schemaLocation="ots-animation.xsd" />

  <xsd:element name="Ots">
    <xsd:complexType>
      <xsd:sequence>
        <xsd:element ref="ots:Definitions" minOccurs="1" maxOccurs="1" />
        <xsd:element ref="ots:Network" minOccurs="1" maxOccurs="1" />
        <xsd:element ref="ots:Demand" minOccurs="0" maxOccurs="1" />
        <xsd:element ref="ots:Control" minOccurs="0" maxOccurs="1" />
        <xsd:element ref="ots:Models" minOccurs="0" maxOccurs="1" />
        <xsd:element ref="ots:Scenarios" minOccurs="0" maxOccurs="1" />
        <xsd:element ref="ots:Run" minOccurs="1" maxOccurs="1" />
        <xsd:element ref="ots:Animation" minOccurs="0" maxOccurs="1" />
      </xsd:sequence>
      <xsd:attribute name="Space" type="ots:space" use="optional" default="preserve" />
    </xsd:complexType>

    <!-- ================================================================================================== -->
    <!-- =========================================== XPATH KEYS =========================================== -->
    <!-- ================================================================================================== -->

    <!-- Keys can be with DefaultInputParameters.String, as elements referring to the key may do so by an input parameter. -->
    <!-- Note that such keys may only have a single Id field, as an input parameter should be able to define it. -->
    <!-- Such keys can only be used at the root level. Other levels are not aware of the default parameters context. -->

    <!-- ======================================== DEFINITIONS KEYS ======================================== -->

    <!-- GtuTypes.GtuType.Id key -->
    <xsd:key name="gtuTypeKey">
      <xsd:selector xpath=".//ots:GtuTypes/ots:GtuType|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- :GtuTemplates.GtuTemplate.Id key -->
    <xsd:key name="gtuTemplateKey">
      <xsd:selector xpath=".//ots:GtuTemplates/ots:GtuTemplate|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- LinkTypes.LinkType.Id key -->
    <xsd:key name="linkTypeKey">
      <xsd:selector xpath=".//ots:LinkTypes/ots:LinkType|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- LaneTypes.LaneType.Id key -->
    <xsd:key name="laneTypeKey">
      <xsd:selector xpath=".//ots:LaneTypes/ots:LaneType|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- DetectorTypes.DetectorType.Id key -->
    <xsd:key name="detectorTypeKey">
      <xsd:selector xpath=".//ots:DetectorTypes/ots:DetectorType|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- RoadLayouts.RoadLayout.Id key -->
    <xsd:key name="roadLayoutKey">
      <xsd:selector xpath=".//ots:RoadLayouts/ots:RoadLayout|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- Definitions.LaneBiases.LaneBias.GtuType key -->
    <xsd:key name="definitionsLaneBiasGtuTypeKey">
      <xsd:selector xpath=".//ots:Definitions/ots:LaneBiases/ots:LaneBias|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@GtuType|@Id" />
    </xsd:key>

    <!-- ParameterTypes.Duration.Id key -->
    <xsd:key name="parameterTypesDurationKey">
      <xsd:selector xpath=".//ots:ParameterTypes/ots:Duration|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- ParameterTypes.Length.Id key -->
    <xsd:key name="parameterTypesLengthKey">
      <xsd:selector xpath=".//ots:ParameterTypes/ots:Length|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- ParameterTypes.Speed.Id key -->
    <xsd:key name="parameterTypesSpeedKey">
      <xsd:selector xpath=".//ots:ParameterTypes/ots:Speed|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- ParameterTypes.Acceleration.Id key -->
    <xsd:key name="parameterTypesAccelerationKey">
      <xsd:selector xpath=".//ots:ParameterTypes/ots:Acceleration|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- ParameterTypes.LinearDensity.Id key -->
    <xsd:key name="parameterTypesLinearDensityKey">
      <xsd:selector xpath=".//ots:ParameterTypes/ots:LinearDensity|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- ParameterTypes.Frequency.Id key -->
    <xsd:key name="parameterTypesFrequencyKey">
      <xsd:selector xpath=".//ots:ParameterTypes/ots:Frequency|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- ParameterTypes.Double.Id key -->
    <xsd:key name="parameterTypesDoubleKey">
      <xsd:selector xpath=".//ots:ParameterTypes/ots:Double|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- ParameterTypes.Fraction.Id key -->
    <xsd:key name="parameterTypesFractionKey">
      <xsd:selector xpath=".//ots:ParameterTypes/ots:Fraction|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- ParameterTypes.Integer.Id key -->
    <xsd:key name="parameterTypesIntegerKey">
      <xsd:selector xpath=".//ots:ParameterTypes/ots:Integer|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- ParameterTypes.Boolean.Id key -->
    <xsd:key name="parameterTypesBooleanKey">
      <xsd:selector xpath=".//ots:ParameterTypes/ots:Boolean|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- ParameterTypes.String.Id key -->
    <xsd:key name="parameterTypesStringKey">
      <xsd:selector xpath=".//ots:ParameterTypes/ots:String|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- ParameterTypes.Class.Id key -->
    <xsd:key name="parameterTypesClassKey">
      <xsd:selector xpath=".//ots:ParameterTypes/ots:Class|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- ========================================== NETWORK KEYS ========================================== -->

    <!-- Network.Node.Id key -->
    <xsd:key name="nodeKey">
      <xsd:selector xpath="ots:Network/ots:Node|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- Network.Centroid.Id key -->
    <xsd:key name="centroidKey">
      <xsd:selector xpath="ots:Network/ots:Centroid|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- Network.{Node.Id|Centroid.Id} key -->
    <xsd:key name="nodeOrCentroidKey">
      <xsd:selector xpath="ots:Network/ots:Node|ots:Network/ots:Centroid|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- Network.Connector.Id key -->
    <xsd:key name="connectorKey">
      <xsd:selector xpath="ots:Network/ots:Connector|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- Network.Link.Id key -->
    <xsd:key name="linkKey">
      <xsd:selector xpath="ots:Network/ots:Link|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- =========================================== DEMAND KEYS ========================================== -->

    <!-- Demand.Od.Id key -->
    <xsd:key name="odKey">
      <xsd:selector xpath="ots:Demand/ots:Od|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- Demand.OdOptions.Id key -->
    <xsd:key name="odOptionsKey">
      <xsd:selector xpath="ots:Demand/ots:OdOptions|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- Demand.Category.Id key -->
    <xsd:key name="categoryKey">
      <xsd:selector xpath="ots:Demand/ots:Od/ots:Category|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- Demand.Route.Id key -->
    <xsd:key name="routeKey">
      <xsd:selector xpath="ots:Demand/ots:Route|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- Demand.ShortestRoute.Id key -->
    <xsd:key name="shortestRouteKey">
      <xsd:selector xpath="ots:Demand/ots:ShortestRoute|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- Demand.{Route.Id|ShortestRoute.Id} key -->
    <xsd:key name="routeOrShortestRouteKey">
      <xsd:selector
        xpath="ots:Demand/ots:Route|ots:Demand/ots:ShortestRoute|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- Demand.RouteMix.Id key -->
    <xsd:key name="routeMixKey">
      <xsd:selector xpath="ots:Demand/ots:RouteMix|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- Demand.ShortestRouteMix.Id key -->
    <xsd:key name="shortestRouteMixKey">
      <xsd:selector xpath="ots:Demand/ots:ShortestRouteMix|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- Demand.GtuTemplateMix.Id key -->
    <xsd:key name="gtuTemplateMixKey">
      <xsd:selector xpath="ots:Demand/ots:GtuTemplateMix|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>
    
    <!-- Demand.InjectionGenerator.Arrivals.Arrival.Id unique -->
    <xsd:unique name="arrivalGtuIdUnique">
      <xsd:selector xpath="ots:Demand/ots:InjectionGenerator/ots:Arrivals/ots:Arrival" />
      <xsd:field xpath="@Id" />
    </xsd:unique>

    <!-- ========================================== CONTROL KEYS ========================================== -->

    <!-- Control.FixedTime.Id key -->
    <xsd:key name="controlFixedTimeKey">
      <xsd:selector xpath="ots:Control/ots:FixedTime|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- ========================================== SCENARIO KEYS ========================================= -->

    <!-- Scenarios.Scenario.Id key -->
    <xsd:key name="scenarioKey">
      <xsd:selector xpath="ots:Scenarios/ots:Scenario" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- ============================================ RUN KEYS ============================================ -->

    <!-- Run.RandomStream.Id key -->
    <xsd:key name="randomStreamKey">
      <xsd:selector xpath="ots:Run/ots:RandomStreams/ots:RandomStream|.//ots:DefaultInputParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:key>

    <!-- ================================================================================================== -->
    <!-- ========================================== XPATH KEYREFS ========================================= -->
    <!-- ================================================================================================== -->

    <!-- Keyref fields can be defined with "." = element value, "@x" = element attribute, or "ots:x" is child value. -->

    <!-- =========================================== OTS KEYREFS ========================================== -->

    <!-- RandomStreamSource.Defined = RandomStream.Id -->
    <xsd:keyref name="randomStreamDefinedId" refer="ots:randomStreamKey">
      <xsd:selector xpath=".//ots:RandomStreamSource/ots:Defined" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- ======================================= DEFINITIONS KEYREFS ====================================== -->

    <!-- GtuType.Parent = GtuType.Id -->
    <xsd:keyref name="gtuTypeParentRef" refer="ots:gtuTypeKey">
      <xsd:selector xpath=".//ots:GtuTypes/ots:GtuType" />
      <xsd:field xpath="@Parent" />
    </xsd:keyref>

    <!-- GtuTemplates.GtuTemplate.GtuType = GtuType.Id -->
    <xsd:keyref name="gtuTemplateTypeRef" refer="ots:gtuTypeKey">
      <xsd:selector xpath=".//ots:GtuTemplates/ots:GtuTemplate" />
      <xsd:field xpath="@GtuType" />
    </xsd:keyref>

    <!-- LaneTypes.LaneType.Parent = LaneType.Id -->
    <xsd:keyref name="laneTypeParentRef" refer="ots:laneTypeKey">
      <xsd:selector xpath=".//ots:LaneTypes/ots:LaneType" />
      <xsd:field xpath="@Parent" />
    </xsd:keyref>

    <!-- LinkTypes.LinkType.Parent = LinkType.Id -->
    <xsd:keyref name="linkTypeParentRef" refer="ots:linkTypeKey">
      <xsd:selector xpath=".//ots:LinkTypes/ots:LinkType" />
      <xsd:field xpath="@Parent" />
    </xsd:keyref>

    <!-- DetectorTypes.DetectorType.Parent = DetectorType.Id -->
    <xsd:keyref name="detectorTypeParentRef" refer="ots:detectorTypeKey">
      <xsd:selector xpath=".//ots:DetectorTypes/ots:DetectorType" />
      <xsd:field xpath="@Parent" />
    </xsd:keyref>

    <!-- Compatibility.GtuType = GtuType.Id -->
    <xsd:keyref name="compatibilityGtuTypeRef" refer="ots:gtuTypeKey">
      <xsd:selector xpath=".//ots:Compatibility" />
      <xsd:field xpath="@GtuType" />
    </xsd:keyref>

    <!-- {LinkType|RoadLayout|Lane|LaneOverride}.SpeedLimit.GtuType = GtuType.Id -->
    <xsd:keyref name="speedlimitGtuTypeRef" refer="ots:gtuTypeKey">
      <xsd:selector
        xpath=".//ots:LinkType/ots:SpeedLimit|.//ots:RoadLayout/ots:SpeedLimit|.//ots:Lane/ots:SpeedLimit|.//ots:LaneOverride/ots:SpeedLimit" />
      <xsd:field xpath="@GtuType" />
    </xsd:keyref>

    <!-- RoadLayout.Lane.LaneType = LaneType.Id -->
    <xsd:keyref name="laneLaneTypeRef" refer="ots:laneTypeKey">
      <xsd:selector xpath=".//ots:RoadLayout/ots:Lane" />
      <xsd:field xpath="@LaneType" />
    </xsd:keyref>
    
    <!-- RoadLayout.Shoulder.LaneType = LaneType.Id -->
    <xsd:keyref name="shoulderLaneTypeRef" refer="ots:laneTypeKey">
      <xsd:selector xpath=".//ots:RoadLayout/ots:Shoulder" />
      <xsd:field xpath="@LaneType" />
    </xsd:keyref>

    <!-- RoadLayout.LinkType = LinkType.Id -->
    <xsd:keyref name="roadlayoutLinkTypeRef" refer="ots:linkTypeKey">
      <xsd:selector xpath=".//ots:RoadLayout" />
      <xsd:field xpath="@LinkType" />
    </xsd:keyref>

    <!-- LaneBias.GtuType = GtuType.Id -->
    <xsd:keyref name="laneBiasGtuTypeRef" refer="ots:gtuTypeKey">
      <xsd:selector xpath=".//ots:LaneBias" />
      <xsd:field xpath="@GtuType" />
    </xsd:keyref>

    <!-- ========================================= NETWORK KEYREFS ======================================== -->

    <!-- Network.Link.NodeStart = Node.Id -->
    <xsd:keyref name="linkNodeStartIdRef" refer="ots:nodeKey">
      <xsd:selector xpath="ots:Network/ots:Link" />
      <xsd:field xpath="@NodeStart" />
    </xsd:keyref>

    <!-- Network.Link.NodeEnd = Node.Id -->
    <xsd:keyref name="linkNodeEndIdRef" refer="ots:nodeKey">
      <xsd:selector xpath="ots:Network/ots:Link" />
      <xsd:field xpath="@NodeEnd" />
    </xsd:keyref>

    <!-- Network.Connector.Centroid = Centroid.Id -->
    <xsd:keyref name="connectorCentroidIdRef" refer="ots:centroidKey">
      <xsd:selector xpath="ots:Network/ots:Connector" />
      <xsd:field xpath="@Centroid" />
    </xsd:keyref>

    <!-- Network.Connector.Node = Node.Id -->
    <xsd:keyref name="connectorNodeIdRef" refer="ots:nodeKey">
      <xsd:selector xpath="ots:Network/ots:Connector" />
      <xsd:field xpath="@Node" />
    </xsd:keyref>

    <!-- Network.Link.DefinedRoadLayout = RoadLayout.Id -->
    <xsd:keyref name="definedRoadLayoutIdRef" refer="ots:roadLayoutKey">
      <xsd:selector xpath="ots:Network/ots:Link/ots:DefinedLayout" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Network.Link.Type = LinkType.Id -->
    <xsd:keyref name="linkTypeIdRef" refer="ots:linkTypeKey">
      <xsd:selector xpath="ots:Network/ots:Link" />
      <xsd:field xpath="@Type" />
    </xsd:keyref>

    <!-- Network.Connector.Type = LinkType.Id -->
    <xsd:keyref name="connectorTypeIdRef" refer="ots:linkTypeKey">
      <xsd:selector xpath="ots:Network/ots:Connector" />
      <xsd:field xpath="@Type" />
    </xsd:keyref>

    <!-- TrafficLight.TurnOnRed = Node.Id -->
    <xsd:keyref name="turnOnRedIdRef" refer="ots:nodeKey">
      <xsd:selector xpath=".//ots:TrafficLight/ots:TurnOnRed" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- ========================================= DEMAND KEYREFS ========================================= -->

    <!-- Demand.Route.Node = Node.Id -->
    <xsd:keyref name="routeNodeIdRef" refer="ots:nodeOrCentroidKey">
      <xsd:selector xpath="ots:Demand/ots:Route/ots:Node" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Demand.Route.GtuType = GtuType.Id -->
    <xsd:keyref name="routeGtuTypeIdRef" refer="ots:gtuTypeKey">
      <xsd:selector xpath="ots:Demand/ots:Route" />
      <xsd:field xpath="@GtuType" />
    </xsd:keyref>

    <!-- Demand.ShortestRoute.From = Node.Id -->
    <xsd:keyref name="shortestRouteFromIdRef" refer="ots:nodeOrCentroidKey">
      <xsd:selector xpath="ots:Demand/ots:ShortestRoute/ots:From" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Demand.ShortestRoute.To = Node.Id -->
    <xsd:keyref name="shortestRouteToIdRef" refer="ots:nodeOrCentroidKey">
      <xsd:selector xpath="ots:Demand/ots:ShortestRoute/ots:To" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Demand.ShortestRoute.Via = Node.Id -->
    <xsd:keyref name="shortestRouteViaIdRef" refer="ots:nodeKey">
      <xsd:selector xpath="ots:Demand/ots:ShortestRoute/ots:Via" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Demand.ShortestRoute.GtuType = GtuType.Id -->

    <xsd:keyref name="shortestRouteGtuTypeIdRef" refer="ots:gtuTypeKey">
      <xsd:selector xpath="ots:Demand/ots:ShortestRoute" />
      <xsd:field xpath="@GtuType" />
    </xsd:keyref>

    <!-- Demand.RouteMix.Route.Id = Route.Id -->
    <xsd:keyref name="routeMixRouteIdRef" refer="ots:routeKey">
      <xsd:selector xpath="ots:Demand/ots:RouteMix/ots:Route" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- Demand.RouteMix.GtuType = GtuType.Id -->
    <xsd:keyref name="routeMixGtuTypeIdRef" refer="ots:gtuTypeKey">
      <xsd:selector xpath="ots:Demand/ots:RouteMix" />
      <xsd:field xpath="@GtuType" />
    </xsd:keyref>

    <!-- Demand.ShortestRouteMix.ShortestRoute.Id = ShortestRoute.Id -->
    <xsd:keyref name="shortestRouteMixShortestRouteIdRef" refer="ots:shortestRouteKey">
      <xsd:selector xpath="ots:Demand/ots:ShortestRouteMix/ots:ShortestRoute" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- Demand.ShortestRouteMix.GtuType = GtuType.Id -->
    <xsd:keyref name="shortestRouteMixGtuTypeIdRef" refer="ots:gtuTypeKey">
      <xsd:selector xpath="ots:Demand/ots:ShortestRouteMix" />
      <xsd:field xpath="@GtuType" />
    </xsd:keyref>

    <!-- Demand.GtuTemplateMix.GtuTemplate.Id = GtuTemplate.Id -->
    <xsd:keyref name="gtuMixGtuTemplateIdRef" refer="ots:gtuTemplateKey">
      <xsd:selector xpath="ots:Demand/ots:GtuTemplateMix/ots:GtuTemplate" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- Demand.Generator.Link = Link.Id -->
    <xsd:keyref name="generatorLinkIdRef" refer="ots:linkKey">
      <xsd:selector xpath="ots:Demand/ots:Generator" />
      <xsd:field xpath="@Link" />
    </xsd:keyref>

    <!-- Demand.Generator.GtuTemplate = GtuTemplate.Id -->
    <xsd:keyref name="generatorGtuTemplateIdRef" refer="ots:gtuTemplateKey">
      <xsd:selector xpath="ots:Demand/ots:Generator" />
      <xsd:field xpath="ots:GtuTemplate" />
    </xsd:keyref>

    <!-- Demand.Generator.GtuTemplateMix = GtuTemplateMix.Id -->
    <xsd:keyref name="generatorGtuTemplateMixIdRef" refer="ots:gtuTemplateMixKey">
      <xsd:selector xpath="ots:Demand/ots:Generator" />
      <xsd:field xpath="ots:GtuTemplateMix" />
    </xsd:keyref>

    <!-- Demand.Generator.Route = Route.Id -->
    <xsd:keyref name="generatorRouteIdRef" refer="ots:routeKey">
      <xsd:selector xpath="ots:Demand/ots:Generator" />
      <xsd:field xpath="ots:Route" />
    </xsd:keyref>

    <!-- Demand.Generator.RouteMix = RouteMix.Id -->
    <xsd:keyref name="generatorRouteMixIdRef" refer="ots:routeMixKey">
      <xsd:selector xpath="ots:Demand/ots:Generator" />
      <xsd:field xpath="ots:RouteMix" />
    </xsd:keyref>

    <!-- Demand.Generator.ShortestRoute = ShortestRoute.Id -->
    <xsd:keyref name="generatorShortestRouteouteIdRef" refer="ots:shortestRouteKey">
      <xsd:selector xpath="ots:Demand/ots:Generator" />
      <xsd:field xpath="ots:ShortestRoute" />
    </xsd:keyref>

    <!-- Demand.Generator.ShortestRouteMix = ShortestRouteMix.Id -->
    <xsd:keyref name="generatorShortestRouteMixIdRef" refer="ots:shortestRouteMixKey">
      <xsd:selector xpath="ots:Demand/ots:Generator" />
      <xsd:field xpath="ots:ShortestRouteMix" />
    </xsd:keyref>

    <!-- Demand.InjectionGenerator.Position.Link = Link.Id -->
    <xsd:keyref name="injectionGeneratorLinkIdRef" refer="ots:linkKey">
      <xsd:selector xpath="ots:Demand/ots:InjectionGenerator/ots:Position" />
      <xsd:field xpath="@Link" />
    </xsd:keyref>

    <!-- Demand.InjectionGenerator.GtuCharacteristics.GtuTemplate = GtuTemplate.Id -->
    <xsd:keyref name="injectionGeneratorGtuTemplateIdRef" refer="ots:gtuTemplateKey">
      <xsd:selector xpath="ots:Demand/ots:InjectionGenerator/ots:GtuCharacteristics/ots:GtuTemplate" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Demand.InjectionGenerator.GtuCharacteristics.GtuTemplateMix = GtuTemplateMix.Id -->
    <xsd:keyref name="injectionGeneratorGtuTemplateMixIdRef" refer="ots:gtuTemplateMixKey">
      <xsd:selector xpath="ots:Demand/ots:InjectionGenerator/ots:GtuCharacteristics/ots:GtuTemplateMix" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Demand.InjectionGenerator.GtuCharacteristics.Route = Route.Id -->
    <xsd:keyref name="injectionGeneratorRouteIdRef" refer="ots:routeKey">
      <xsd:selector xpath="ots:Demand/ots:InjectionGenerator/ots:GtuCharacteristics/ots:Route" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Demand.InjectionGenerator.GtuCharacteristics.RouteMix = RouteMix.Id -->
    <xsd:keyref name="injectionGeneratorRouteMixIdRef" refer="ots:routeMixKey">
      <xsd:selector xpath="ots:Demand/ots:InjectionGenerator/ots:GtuCharacteristics/ots:RouteMix" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Demand.InjectionGenerator.GtuCharacteristics.ShortestRoute = ShortestRoute.Id -->
    <xsd:keyref name="injectionGeneratorShortestRouteouteIdRef" refer="ots:shortestRouteKey">
      <xsd:selector xpath="ots:Demand/ots:InjectionGenerator/ots:GtuCharacteristics/ots:ShortestRoute" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Demand.InjectionGenerator.GtuCharacteristics.ShortestRouteMix = ShortestRouteMix.Id -->
    <xsd:keyref name="injectionGeneratorShortestRouteMixIdRef" refer="ots:shortestRouteMixKey">
      <xsd:selector xpath="ots:Demand/ots:InjectionGenerator/ots:GtuCharacteristics/ots:ShortestRouteMix" />
      <xsd:field xpath="." />
    </xsd:keyref>
    
    <!-- Demand.InjectionGenerator.Arrivals.Arrival.GtuType = GtuType.Id -->
    <xsd:keyref name="arrivalGtuTypeIdRef" refer="ots:gtuTypeKey">
      <xsd:selector xpath="ots:Demand/ots:InjectionGenerator/ots:Arrivals/ots:Arrival" />
      <xsd:field xpath="@GtuType" />
    </xsd:keyref>
    
    <!-- Demand.InjectionGenerator.Arrivals.Arrival.Link = Link.Id -->
    <xsd:keyref name="arrivalLinkIdRef" refer="ots:linkKey">
      <xsd:selector xpath="ots:Demand/ots:InjectionGenerator/ots:Arrivals/ots:Arrival" />
      <xsd:field xpath="@Link" />
    </xsd:keyref>
    
    <!-- Demand.InjectionGenerator.Arrivals.Arrival.Route = Route.Id -->
    <xsd:keyref name="arrivalRouteIdRef" refer="ots:routeKey">
      <xsd:selector xpath="ots:Demand/ots:InjectionGenerator/ots:Arrivals/ots:Arrival" />
      <xsd:field xpath="@Route" />
    </xsd:keyref>
    
    <!-- Demand.InjectionGenerator.Arrivals.Arrival.Origin = Node.Id -->
    <xsd:keyref name="arrivalOriginIdRef" refer="ots:nodeKey">
      <xsd:selector xpath="ots:Demand/ots:InjectionGenerator/ots:Arrivals/ots:Arrival" />
      <xsd:field xpath="@Origin" />
    </xsd:keyref>
    
    <!-- Demand.InjectionGenerator.Arrivals.Arrival.Destination = Node.Id -->
    <xsd:keyref name="arrivalDestinationIdRef" refer="ots:nodeKey">
      <xsd:selector xpath="ots:Demand/ots:InjectionGenerator/ots:Arrivals/ots:Arrival" />
      <xsd:field xpath="@Destination" />
    </xsd:keyref>

    <!-- Demand.Od.Cell.Origin = {Node|Centroid}.Id -->
    <xsd:keyref name="cellOriginIdRef" refer="ots:nodeOrCentroidKey">
      <xsd:selector xpath="ots:Demand/ots:Od/ots:Cell" />
      <xsd:field xpath="@Origin" />
    </xsd:keyref>

    <!-- Demand.Od.Cell.Destination = {Node|Centroid}.Id -->
    <xsd:keyref name="cellDestinationIdRef" refer="ots:nodeOrCentroidKey">
      <xsd:selector xpath="ots:Demand/ots:Od/ots:Cell" />
      <xsd:field xpath="@Destination" />
    </xsd:keyref>

    <!-- Demand.Od.Cell.Category = Cagtegory.Id -->
    <xsd:keyref name="cellCategoryIdRef" refer="ots:categoryKey">
      <xsd:selector xpath="ots:Demand/ots:Od/ots:Cell" />
      <xsd:field xpath="@Category" />
    </xsd:keyref>

    <!-- Demand.Od.Category.GtuType = GtuType.Od -->
    <xsd:keyref name="categoryGtuTypeIdRef" refer="ots:gtuTypeKey">
      <xsd:selector xpath="ots:Demand/ots:Od/ots:Category" />
      <xsd:field xpath="@GtuType" />
    </xsd:keyref>

    <!-- Demand.Od.Category.Lane.Link = Link.Id -->
    <xsd:keyref name="categoryLinkIdRef" refer="ots:linkKey">
      <xsd:selector xpath="ots:Demand/ots:Od/ots:Category/ots:Lane" />
      <xsd:field xpath="@Link" />
    </xsd:keyref>

    <!-- Demand.Od.Category.Route = {Route|ShortestRoute}.Id -->
    <xsd:keyref name="categoryRouteIdRef" refer="ots:routeOrShortestRouteKey">
      <xsd:selector xpath="ots:Demand/ots:Od/ots:Category" />
      <xsd:field xpath="@Route" />
    </xsd:keyref>

    <!-- Demand.Od.SinkType = DetectorType.Id -->
    <xsd:keyref name="odSinkTypeIdRef" refer="ots:detectorTypeKey">
      <xsd:selector xpath="ots:Demand/ots:Od" />
      <xsd:field xpath="@SinkType" />
    </xsd:keyref>

    <!-- Demand.OdOptions.OdOptionsItem.Lane.Link = Link.Id -->
    <xsd:keyref name="odOptionsItemLaneLinkIdRef" refer="ots:linkKey">
      <xsd:selector xpath="ots:Demand/ots:OdOptions/ots:OdOptionsItem/ots:Lane" />
      <xsd:field xpath="@Link" />
    </xsd:keyref>

    <!-- Demand.Sink.Type = DetectorType.Id -->
    <xsd:keyref name="sinkTypeIdRef" refer="ots:detectorTypeKey">
      <xsd:selector xpath="ots:Demand/ots:Sink" />
      <xsd:field xpath="@Type" />
    </xsd:keyref>

    <!-- Demand.Sink.Link = Link.Id -->
    <xsd:keyref name="sinkLinkIdRef" refer="ots:linkKey">
      <xsd:selector xpath="ots:Demand/ots:Sink" />
      <xsd:field xpath="@Link" />
    </xsd:keyref>

    <!-- DefinedLaneBias.GtuType is Definitions.LaneBiases.LaneBias.GtuType -->
    <xsd:keyref name="definedLaneBiasGtuTypeRef" refer="ots:definitionsLaneBiasGtuTypeKey">
      <xsd:selector xpath="ots:LaneBiases/ots:LaneBias" />
      <xsd:field xpath="@GtuType" />
    </xsd:keyref>

    <!-- Demand.OdOptions.OdOptionsItem.Markov.State.GtuType = GtuType.Id -->
    <xsd:keyref name="markovStateGtuTypeRef" refer="ots:gtuTypeKey">
      <xsd:selector xpath="ots:Demand/ots:OdOptions/ots:OdOptionsItem/ots:Markov/ots:State" />
      <xsd:field xpath="@GtuType" />
    </xsd:keyref>

    <!-- Demand.OdOptions.OdOptionsItem.Markov.State.Parent = GtuType.Id -->
    <xsd:keyref name="markovStateParentGtuTypeRef" refer="ots:gtuTypeKey">
      <xsd:selector xpath="ots:Demand/ots:OdOptions/ots:OdOptionsItem/ots:Markov/ots:State" />
      <xsd:field xpath="@Parent" />
    </xsd:keyref>

    <!-- Demand.OdOptions.OdOptionsItem.LinkType = LinkType.Id -->
    <xsd:keyref name="linkTypeValueLinkTypeRef" refer="ots:linkTypeKey">
      <xsd:selector xpath="ots:Demand/ots:OdOptions/ots:OdOptionsItem" />
      <xsd:field xpath="ots:LinkType" />
    </xsd:keyref>

    <!-- Demand.OdOptions.OdOptionsItem.Origin = {Node|Centroid}.Id -->
    <xsd:keyref name="originNodeValueNodeRef" refer="ots:nodeOrCentroidKey">
      <xsd:selector xpath="ots:Demand/ots:OdOptions/ots:OdOptionsItem/ots:Origin" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Demand.OdOptions.OdOptionsItem.Lane.Link = Link.Id -->
    <xsd:keyref name="laneLinkRef" refer="ots:linkKey">
      <xsd:selector xpath="ots:Demand/ots:OdOptions/ots:OdOptionsItem/ots:Lane" />
      <xsd:field xpath="@Link" />
    </xsd:keyref>

    <!-- Demand.Od.Options = OdOptions.Id -->
    <xsd:keyref name="odOdOptionsRef" refer="ots:odOptionsKey">
      <xsd:selector xpath="ots:Demand/ots:Od" />
      <xsd:field xpath="@Options" />
    </xsd:keyref>

    <!-- ========================================= CONTROL KEYREFS ======================================== -->

    <!-- SignalGroup.TrafficLight.Link = Link.Id -->
    <xsd:keyref name="signalGroupLinkIdRef" refer="ots:linkKey">
      <xsd:selector xpath=".//ots:SignalGroup/ots:TrafficLight" />
      <xsd:field xpath="@Link" />
    </xsd:keyref>

    <!-- TrafCod.Detector.Type = DetectorType.Id -->
    <xsd:keyref name="trafCodDetectorTypeIdRef" refer="ots:detectorTypeKey">
      <xsd:selector xpath="ots:Control/ots:TrafCod/ots:Detector" />
      <xsd:field xpath="@Type" />
    </xsd:keyref>

    <!-- ========================================== MODEL KEYREFS ========================================= -->

    <!-- Models.Model.GtuType = GtuType.Id -->
    <xsd:keyref name="modelGtuTypeRef" refer="ots:gtuTypeKey">
      <xsd:selector xpath="ots:Models/ots:Model" />
      <xsd:field xpath="@GtuType" />
    </xsd:keyref>

    <!-- ModelParameters.Duration.Id = ParameterTypes.Duration.Id -->
    <xsd:keyref name="modelParametersDurationRef" refer="ots:parameterTypesDurationKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:Duration" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.DurationDist.Id = ParameterTypes.Duration.Id -->
    <xsd:keyref name="modelParametersDurationDistRef" refer="ots:parameterTypesDurationKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:DurationDist" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.Length.Id = ParameterTypes.Length.Id -->
    <xsd:keyref name="modelParametersLengthRef" refer="ots:parameterTypesLengthKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:Length" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.LengthDist.Id = ParameterTypes.Length.Id -->
    <xsd:keyref name="modelParametersLengthDistRef" refer="ots:parameterTypesLengthKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:LengthDist" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.Speed.Id = ParameterTypes.Speed.Id -->
    <xsd:keyref name="modelParametersSpeedRef" refer="ots:parameterTypesSpeedKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:Speed" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.SpeedDist.Id = ParameterTypes.Speed.Id -->
    <xsd:keyref name="modelParametersSpeedDistRef" refer="ots:parameterTypesSpeedKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:SpeedDist" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.Acceleration.Id = ParameterTypes.Acceleration.Id -->
    <xsd:keyref name="modelParametersAccelerationRef" refer="ots:parameterTypesAccelerationKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:Acceleration" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.AccelerationDist.Id = ParameterTypes.Acceleration.Id -->
    <xsd:keyref name="modelParametersAccelerationDistRef" refer="ots:parameterTypesAccelerationKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:AccelerationDist" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.LinearDensity.Id = ParameterTypes.LinearDensity.Id -->
    <xsd:keyref name="modelParametersLinearDensityRef" refer="ots:parameterTypesLinearDensityKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:LinearDensity" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.LinearDensityDist.Id = ParameterTypes.LinearDensity.Id -->
    <xsd:keyref name="modelParametersLinearDensityDistRef" refer="ots:parameterTypesLinearDensityKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:LinearDensityDist" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.Frequency.Id = ParameterTypes.Frequency.Id -->
    <xsd:keyref name="modelParametersFrequencyRef" refer="ots:parameterTypesFrequencyKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:Frequency" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.FrequencyDist.Id = ParameterTypes.Frequency.Id -->
    <xsd:keyref name="modelParametersFrequencyDistRef" refer="ots:parameterTypesFrequencyKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:FrequencyDist" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.Double.Id = ParameterTypes.Double.Id -->
    <xsd:keyref name="modelParametersDoubleRef" refer="ots:parameterTypesDoubleKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:Double" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.DoubleDist.Id = ParameterTypes.Double.Id -->
    <xsd:keyref name="modelParametersDoubleDistRef" refer="ots:parameterTypesDoubleKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:DoubleDist" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.Fraction.Id = ParameterTypes.Fraction.Id -->
    <xsd:keyref name="modelParametersFractionRef" refer="ots:parameterTypesFractionKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:Fraction" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.Integer.Id = ParameterTypes.Integer.Id -->
    <xsd:keyref name="modelParametersIntegerRef" refer="ots:parameterTypesIntegerKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:Integer" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.IntegerDist.Id = ParameterTypes.Integer.Id -->
    <xsd:keyref name="modelParametersIntegerDistRef" refer="ots:parameterTypesIntegerKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:IntegerDist" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.Boolean.Id = ParameterTypes.Boolean.Id -->
    <xsd:keyref name="modelParametersBooleanRef" refer="ots:parameterTypesBooleanKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:Boolean" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.String.Id = ParameterTypes.String.Id -->
    <xsd:keyref name="modelParametersStringRef" refer="ots:parameterTypesStringKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:String" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ModelParameters.Class.Id = ParameterTypes.Class.Id -->
    <xsd:keyref name="modelParametersClassRef" refer="ots:parameterTypesClassKey">
      <xsd:selector xpath=".//ots:ModelParameters/ots:Class" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- Correlation.Duration = ParameterTypes.Duration.Id -->
    <xsd:keyref name="modelCorrelationDurationRef" refer="ots:parameterTypesDurationKey">
      <xsd:selector xpath=".//ots:CorrelationParameterType/ots:Duration" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Correlation.Length = ParameterTypes.Length.Id -->
    <xsd:keyref name="modelCorrelationLengthRef" refer="ots:parameterTypesLengthKey">
      <xsd:selector xpath=".//ots:CorrelationParameterType/ots:Length" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Correlation.Speed = ParameterTypes.Speed.Id -->
    <xsd:keyref name="modelCorrelationSpeedRef" refer="ots:parameterTypesSpeedKey">
      <xsd:selector xpath=".//ots:CorrelationParameterType/ots:Speed" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Correlation.Acceleration = ParameterTypes.Acceleration.Id -->
    <xsd:keyref name="modelCorrelationAccelerationRef" refer="ots:parameterTypesAccelerationKey">
      <xsd:selector xpath=".//ots:CorrelationParameterType/ots:Acceleration" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Correlation.LinearDensity = ParameterTypes.LinearDensity.Id -->
    <xsd:keyref name="modelCorrelationLinearDensityRef" refer="ots:parameterTypesLinearDensityKey">
      <xsd:selector xpath=".//ots:CorrelationParameterType/ots:LinearDensity" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Correlation.Frequency = ParameterTypes.Frequency.Id -->
    <xsd:keyref name="modelCorrelationFrequencyRef" refer="ots:parameterTypesFrequencyKey">
      <xsd:selector xpath=".//ots:CorrelationParameterType/ots:Frequency" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Correlation.Double = ParameterTypes.Double.Id -->
    <xsd:keyref name="modelCorrelationDoubleRef" refer="ots:parameterTypesDoubleKey">
      <xsd:selector xpath=".//ots:CorrelationParameterType/ots:Double" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Correlation.Fraction = ParameterTypes.Fraction.Id -->
    <xsd:keyref name="modelCorrelationFractionRef" refer="ots:parameterTypesFractionKey">
      <xsd:selector xpath=".//ots:CorrelationParameterType/ots:Fraction" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- Correlation.Integer = ParameterTypes.Integer.Id -->
    <xsd:keyref name="modelCorrelationIntegerRef" refer="ots:parameterTypesIntegerKey">
      <xsd:selector xpath=".//ots:CorrelationParameterType/ots:Integer" />
      <xsd:field xpath="." />
    </xsd:keyref>

    <!-- ======================================== SCENARIOS KEYREFS ======================================= -->

    <!-- Scenario.Od.Id = Od.Id -->
    <xsd:keyref name="scenarioOdRef" refer="ots:odKey">
      <xsd:selector xpath=".//ots:Scenario/ots:Od" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- ======================================== ANIMATION KEYREFS ======================================= -->

    <!-- Animation.LinkType = LinkType.Id -->
    <xsd:keyref name="animationLinkTypeRef" refer="ots:linkTypeKey">
      <xsd:selector xpath="ots:Animation/ots:LinkType" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- Animation.LaneType = LaneType.Id -->
    <xsd:keyref name="animationLaneTypeRef" refer="ots:laneTypeKey">
      <xsd:selector xpath="ots:Animation/ots:LaneType" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- Animation.RoadLayout = RoadLayout.Id -->
    <xsd:keyref name="animationRoadLayoutRef" refer="ots:roadLayoutKey">
      <xsd:selector xpath="ots:Animation/ots:RoadLayout" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- Animation.Connector = Connector.Id -->
    <xsd:keyref name="animationConnectorRef" refer="ots:connectorKey">
      <xsd:selector xpath="ots:Animation/ots:Connector" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

    <!-- Animation.Link = Link.Id -->
    <xsd:keyref name="animationLinkRef" refer="ots:linkKey">
      <xsd:selector xpath="ots:Animation/ots:Link" />
      <xsd:field xpath="@Id" />
    </xsd:keyref>

  </xsd:element>

</xsd:schema>